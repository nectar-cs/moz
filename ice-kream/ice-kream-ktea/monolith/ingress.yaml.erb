<% root = values[:ingress] || {} %>

apiVersion: networking.k8s.io/v1beta1
kind: Ingress
metadata:
  namespace: <%= release_name %>
  name: <%= consts.app_name %>-ingress
  annotations:
    kubernetes.io/ingress.class: <%= root[:class] %>
    cert-manager.io/issuer: <%= consts.issuer_name %>
  labels:
    app: <%= app_name %>
spec:
  tls:
  - hosts:
      <% defined_routes.each do |route| %>
      - <%= route[:host] %>
      <% end %>
    secretName: "echo-tls"
  rules:
    <% defined_routes.each do |route| %>
    - host: <%= route[:host] %>
      http:
        paths:
          - path: <%= route[:path] %>
            backend:
              serviceName: <%= route[:service_name] %>
              servicePort: <%= route[:service_port] %>
    <% end %>
